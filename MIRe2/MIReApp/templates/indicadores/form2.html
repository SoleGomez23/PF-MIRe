<form id= "miFormulario" enctype="multipart/form-data" method="post">
    {% csrf_token %}  
    

        <div class="mb-3">
          <label for="{{ formulario2.descripcion.id_for_label }}" class="form-label">{{ formulario2.descripcion.label }}</label>
          {{ formulario2.descripcion }}  
        </div>
        <div class="col-12 help-text">{{ formulario2.descripcion.errors }}</div>   
 

        <div class="horizontal-fields" style="display:flex" style="flex-direction:row">
          <div style="flex: 1;margin-right: 10px;">
            <label for="{{ formulario2.ambito.id_for_label }}" class="form-label">{{ formulario2.ambito.label }}</label>
            {{ formulario2.ambito }}  
            <div class="help-text">{{ formulario2.ambito.errors }}</div>
          </div>
          
          <div  style="flex: 1;">
            <label for="{{ formulario2.tipo.id_for_label }}" class="form-label">{{ formulario2.tipo.label }}</label>
            {{ formulario2.tipo }}  
            <div class="help-text">{{ formulario2.tipo.errors }}</div>
          </div>
        </div>    
 
    <br>
    <input name="" id="" class="btn btn-success min-content" style="background-color: #965FB8;border-color: #965FB8;margin-left: 206px;" type="submit" value="Confirmar">
    <a name="" id="" class="btn btn-success" style="background-color: #f60; border-color: #f60;margin-left:5px;" href="{% url 'indicadores' %}" role="button">Cancelar</a>
  
  </form>

<script>
    function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
    }

    const csrftoken = getCookie('csrftoken');
    let ambito_field = document.getElementById("id_ambito")//Los id de los campos es igual al nombre del atributo en models.py, precedido de un "id_"
    let tipo_field = document.getElementById("id_tipo")

    ambito_field.addEventListener("change", cargarTipos)
    function cargarTipos(e){
        ambito_id = e.target.value //Selecciona el id del ambito elegido por el usuario
        const data = { user_id: ambito_id} //Agrega el ambito a un objeto 
        let url = " {% url 'tipos' %} " //Configura la url en la que buscarÃ¡ los tipos, en este caso es la vista de tipos (ver en views.py)

    fetch(url, { //Hace la request HTTP
        method: 'POST',
        headers: {
        'Content-Type': 'application/json',
        'X-CSRFToken': csrftoken
        },
        body: JSON.stringify(data), //envia en la id del ambito elegido, la que se guardo mas arriba en la variable data
    })
    .then(response => response.json())
    .then(data => { //se reutiliza la variable data para guardr el resultado, osea todos los tipos relacionados con el ambito elegido
    console.log('Success:', data[0]['nombre']);
    //Se agrega al dropdown todos los elementos recibidos:
    tipo_field.innerHTML = `<option value = "" selescted>---------------</option>`
    for(let i = 0; i<data.length; i++){
        tipo_field.innerHTML += `<option value = "${data[i]["id"]}" selescted>${data[i]["nombre"]}</option>`
    }
    })
    .catch((error) => {
        console.error('Error:', error);
    });//Le agrega la clase de select para que funcione como un dropdown
    let select = document.getElementsByTagName("select")
    console.log(select)
    for(let i = 0; i <select.length; i++){
        console.log(i);
        select[i].classList.add("form-select")
    }
    }

</script>